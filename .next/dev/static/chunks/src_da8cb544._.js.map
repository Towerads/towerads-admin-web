{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/slava/OneDrive/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9%20%D1%81%D1%82%D0%BE%D0%BB/USL/towerads-admin-web/src/lib/api.ts"],"sourcesContent":["const API_URL = process.env.NEXT_PUBLIC_API_URL!;\r\n\r\nexport async function api(\r\n  path: string,\r\n  options: RequestInit = {}\r\n): Promise<any> {\r\n  const token =\r\n    typeof window !== \"undefined\"\r\n      ? localStorage.getItem(\"admin_token\")\r\n      : null;\r\n\r\n  const headers: HeadersInit = {\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n    ...(options.headers || {}),\r\n  };\r\n\r\n  if (options.body) {\r\n    headers[\"Content-Type\"] = \"application/json\";\r\n  }\r\n\r\n  const res = await fetch(`${API_URL}${path}`, {\r\n    mode: \"cors\",              // üî• –í–ê–ñ–ù–û\r\n    credentials: \"include\",    // üî• –í–ê–ñ–ù–û (—É —Ç–µ–±—è cors —Å credentials)\r\n    ...options,\r\n    headers,\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    throw new Error(text || `API error ${res.status}`);\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAgB;AAAhB,MAAM;AAEC,eAAe,IACpB,IAAY,EACZ,UAAuB,CAAC,CAAC;IAEzB,MAAM,QACJ,uCACI,aAAa,OAAO,CAAC,iBACrB;IAEN,MAAM,UAAuB;QAC3B,GAAI,QAAQ;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;QAAC,IAAI,CAAC,CAAC;QACrD,GAAI,QAAQ,OAAO,IAAI,CAAC,CAAC;IAC3B;IAEA,IAAI,QAAQ,IAAI,EAAE;QAChB,OAAO,CAAC,eAAe,GAAG;IAC5B;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,UAAU,MAAM,EAAE;QAC3C,MAAM;QACN,aAAa;QACb,GAAG,OAAO;QACV;IACF;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,CAAC,UAAU,EAAE,IAAI,MAAM,EAAE;IACnD;IAEA,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/slava/OneDrive/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9%20%D1%81%D1%82%D0%BE%D0%BB/USL/towerads-admin-web/src/app/%28admin%29/analytics/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { api } from \"@/lib/api\";\r\n\r\nimport {\r\n  ResponsiveContainer,\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n} from \"recharts\";\r\n\r\ntype Row = {\r\n  provider: string;\r\n  impressions: number | string;\r\n  revenue: number | string;\r\n  cost?: number | string;\r\n  profit?: number | string;\r\n  cpm?: number | string;\r\n};\r\n\r\nconst PERIOD_LABELS = {\r\n  today: \"–°–µ–≥–æ–¥–Ω—è\",\r\n  \"7d\": \"7 –¥–Ω–µ–π\",\r\n  \"30d\": \"30 –¥–Ω–µ–π\",\r\n} as const;\r\n\r\nexport default function AnalyticsPage() {\r\n  const [period, setPeriod] = useState<\"today\" | \"7d\" | \"30d\">(\"today\");\r\n  const [from, setFrom] = useState<string>(\"\");\r\n  const [to, setTo] = useState<string>(\"\");\r\n\r\n  const [rows, setRows] = useState<Row[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n\r\n    const query =\r\n      from && to\r\n        ? `/admin/stats/providers?from=${from}&to=${to}`\r\n        : `/admin/stats/providers?period=${period}`;\r\n\r\n    api(query)\r\n      .then((r) => setRows(r?.stats ?? []))\r\n      .finally(() => setLoading(false));\r\n  }, [period, from, to]);\r\n\r\n  const totals = useMemo(() => {\r\n    const totalImpressions = rows.reduce(\r\n      (sum, r) => sum + Number(r.impressions || 0),\r\n      0\r\n    );\r\n\r\n    const totalRevenue = rows.reduce(\r\n      (sum, r) => sum + Number(r.revenue || 0),\r\n      0\r\n    );\r\n\r\n    const totalCost = rows.reduce(\r\n      (sum, r) => sum + Number(r.cost || 0),\r\n      0\r\n    );\r\n\r\n    const totalProfit = totalRevenue - totalCost;\r\n\r\n    const cpm =\r\n      totalImpressions > 0 ? (totalRevenue / totalImpressions) * 1000 : 0;\r\n\r\n    return {\r\n      totalImpressions,\r\n      totalCost,\r\n      totalProfit,\r\n      cpm,\r\n    };\r\n  }, [rows]);\r\n\r\n  const chartData = useMemo(\r\n    () =>\r\n      rows.map((r) => ({\r\n        provider: r.provider,\r\n        revenue: Number(r.revenue || 0),\r\n      })),\r\n    [rows]\r\n  );\r\n\r\n  function showCPM(r: Row) {\r\n    const imps = Number(r.impressions || 0);\r\n    if (imps < 10) return \"‚Äî\";\r\n    if (r.cpm !== undefined) return `$${Number(r.cpm).toFixed(2)}`;\r\n    return `$${((Number(r.revenue || 0) / imps) * 1000).toFixed(2)}`;\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-inner\">\r\n      <div className=\"page-header\">\r\n        <div>\r\n          <h1 className=\"page-title\">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>\r\n          <p className=\"page-subtitle\">\r\n            –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"split-layout\">\r\n        <aside className=\"side-panel\">\r\n          <div className=\"panel-title\">–û–±–∑–æ—Ä</div>\r\n\r\n          <div className=\"stats-list\">\r\n            <div className=\"stat-row\">\r\n              <span>–ü–µ—Ä–∏–æ–¥</span>\r\n              <strong>\r\n                {from && to ? `${from} ‚Äî ${to}` : PERIOD_LABELS[period]}\r\n              </strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã</span>\r\n              <strong>{rows.length}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>–†–∞—Å—Ö–æ–¥</span>\r\n              <strong>${totals.totalCost.toFixed(2)}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>–ü—Ä–∏–±—ã–ª—å</span>\r\n              <strong>${totals.totalProfit.toFixed(2)}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>CPM</span>\r\n              <strong>\r\n                {totals.totalImpressions < 10\r\n                  ? \"‚Äî\"\r\n                  : `$${totals.cpm.toFixed(2)}`}\r\n              </strong>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"panel-divider\" />\r\n\r\n          <div className=\"panel-title\">–ü–µ—Ä–∏–æ–¥</div>\r\n\r\n          {/* –ö–ù–û–ü–ö–ò */}\r\n          <div className=\"analytics-filters\">\r\n            {([\"today\", \"7d\", \"30d\"] as const).map((p) => (\r\n              <button\r\n                key={p}\r\n                className={`filter ${period === p ? \"active\" : \"\"}`}\r\n                onClick={() => {\r\n                  setPeriod(p);\r\n                  setFrom(\"\");\r\n                  setTo(\"\");\r\n                }}\r\n              >\r\n                {PERIOD_LABELS[p]}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* –û–¢ ‚Äî –î–û –í –û–î–ù–£ –õ–ò–ù–ò–Æ */}\r\n          <div className=\"date-range-line\">\r\n            <input\r\n              type=\"date\"\r\n              value={from}\r\n              onChange={(e) => {\r\n                setFrom(e.target.value);\r\n                setPeriod(\"today\");\r\n              }}\r\n            />\r\n            <span className=\"dash\">‚Äî</span>\r\n            <input\r\n              type=\"date\"\r\n              value={to}\r\n              onChange={(e) => {\r\n                setTo(e.target.value);\r\n                setPeriod(\"today\");\r\n              }}\r\n            />\r\n          </div>\r\n        </aside>\r\n\r\n        <section className=\"main-panel\">\r\n          <div className=\"chart-card\">\r\n            <div className=\"chart-head\">\r\n              <div className=\"chart-title\">–î–æ—Ö–æ–¥ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º</div>\r\n              <div className=\"chart-sub\">\r\n                {from && to ? `${from} ‚Äî ${to}` : PERIOD_LABELS[period]}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"chart-box\">\r\n              {loading ? (\r\n                <div className=\"loading\">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>\r\n              ) : !mounted ? null : chartData.length === 0 ? (\r\n                <div className=\"empty\">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>\r\n              ) : (\r\n                <ResponsiveContainer width=\"100%\" height={260}>\r\n                  <BarChart data={chartData}>\r\n                    <CartesianGrid strokeDasharray=\"3 3\" />\r\n                    <XAxis dataKey=\"provider\" />\r\n                    <YAxis />\r\n                    <Tooltip />\r\n                    <Bar\r\n                      dataKey=\"revenue\"\r\n                      fill=\"#38bdf8\"\r\n                      radius={[6, 6, 0, 0]}\r\n                    />\r\n                  </BarChart>\r\n                </ResponsiveContainer>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"table-card\">\r\n            <table className=\"table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>–ü—Ä–æ–≤–∞–π–¥–µ—Ä</th>\r\n                  <th>–ü–æ–∫–∞–∑—ã</th>\r\n                  <th>–î–æ—Ö–æ–¥ ($)</th>\r\n                  <th>–†–∞—Å—Ö–æ–¥ ($)</th>\r\n                  <th>–ü—Ä–∏–±—ã–ª—å ($)</th>\r\n                  <th>CPM ($)</th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody>\r\n                {rows.map((r) => (\r\n                  <tr key={r.provider}>\r\n                    <td>{r.provider}</td>\r\n                    <td>{Number(r.impressions || 0)}</td>\r\n                    <td>${Number(r.revenue || 0).toFixed(2)}</td>\r\n                    <td>${Number(r.cost || 0).toFixed(2)}</td>\r\n                    <td>\r\n                      $\r\n                      {Number(\r\n                        r.profit ??\r\n                          Number(r.revenue || 0) - Number(r.cost || 0)\r\n                      ).toFixed(2)}\r\n                    </td>\r\n                    <td>{showCPM(r)}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n\r\n            {loading && <div className=\"loading\">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>}\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}