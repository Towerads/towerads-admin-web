{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/slava/OneDrive/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9%20%D1%81%D1%82%D0%BE%D0%BB/USL/towerads-admin-web/src/lib/api.ts"],"sourcesContent":["const API_URL = process.env.NEXT_PUBLIC_API_URL!;\r\n\r\nexport async function api(\r\n  path: string,\r\n  options: RequestInit = {}\r\n): Promise<any> {\r\n  const token =\r\n    typeof window !== \"undefined\"\r\n      ? localStorage.getItem(\"admin_token\")\r\n      : null;\r\n\r\n  const headers: HeadersInit = {\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n    ...(options.headers || {}),\r\n  };\r\n\r\n  if (options.body) {\r\n    headers[\"Content-Type\"] = \"application/json\";\r\n  }\r\n\r\n  const res = await fetch(`${API_URL}${path}`, {\r\n    mode: \"cors\",              // üî• –í–ê–ñ–ù–û\r\n    credentials: \"include\",    // üî• –í–ê–ñ–ù–û (—É —Ç–µ–±—è cors —Å credentials)\r\n    ...options,\r\n    headers,\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    throw new Error(text || `API error ${res.status}`);\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAgB;AAAhB,MAAM;AAEC,eAAe,IACpB,IAAY,EACZ,UAAuB,CAAC,CAAC;IAEzB,MAAM,QACJ,uCACI,aAAa,OAAO,CAAC,iBACrB;IAEN,MAAM,UAAuB;QAC3B,GAAI,QAAQ;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;QAAC,IAAI,CAAC,CAAC;QACrD,GAAI,QAAQ,OAAO,IAAI,CAAC,CAAC;IAC3B;IAEA,IAAI,QAAQ,IAAI,EAAE;QAChB,OAAO,CAAC,eAAe,GAAG;IAC5B;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,UAAU,MAAM,EAAE;QAC3C,MAAM;QACN,aAAa;QACb,GAAG,OAAO;QACV;IACF;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,CAAC,UAAU,EAAE,IAAI,MAAM,EAAE;IACnD;IAEA,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/slava/OneDrive/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B8%D0%B9%20%D1%81%D1%82%D0%BE%D0%BB/USL/towerads-admin-web/src/app/%28admin%29/analytics/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { api } from \"@/lib/api\";\r\n\r\nimport {\r\n  ResponsiveContainer,\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  Legend,\r\n} from \"recharts\";\r\n\r\ntype Row = {\r\n  provider: string;\r\n  impressions: number | string;\r\n  revenue: number | string;\r\n  cost?: number | string;   // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û\r\n  profit?: number | string; // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û\r\n  cpm?: number | string;    // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û\r\n};\r\n\r\nexport default function AnalyticsPage() {\r\n  const [period, setPeriod] = useState<\"today\" | \"7d\" | \"30d\">(\"today\");\r\n  const [rows, setRows] = useState<Row[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    api(`/admin/stats/providers?period=${period}`)\r\n      .then((r) => setRows(r?.stats ?? []))\r\n      .finally(() => setLoading(false));\r\n  }, [period]);\r\n\r\n  const totals = useMemo(() => {\r\n    const totalImpressions = rows.reduce(\r\n      (sum, r) => sum + Number(r.impressions || 0),\r\n      0\r\n    );\r\n    const totalRevenue = rows.reduce(\r\n      (sum, r) => sum + Number(r.revenue || 0),\r\n      0\r\n    );\r\n    const totalCost = rows.reduce(\r\n      (sum, r) => sum + Number(r.cost || 0),\r\n      0\r\n    );\r\n    const totalProfit = totalRevenue - totalCost;\r\n\r\n    const cpm =\r\n      totalImpressions > 0 ? (totalRevenue / totalImpressions) * 1000 : 0;\r\n\r\n    return { totalImpressions, totalRevenue, totalCost, totalProfit, cpm };\r\n  }, [rows]);\r\n\r\n  const chartData = useMemo(() => {\r\n    return rows.map((r) => ({\r\n      provider: r.provider,\r\n      impressions: Number(r.impressions || 0),\r\n      revenue: Number(r.revenue || 0),\r\n    }));\r\n  }, [rows]);\r\n\r\n  function showCPM(r: Row) {\r\n    const imps = Number(r.impressions || 0);\r\n    if (imps < 10) return \"‚Äî\"; // —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ $100 –Ω–∞ 1 –ø–æ–∫–∞–∑–µ\r\n    if (r.cpm !== undefined) return `$${Number(r.cpm).toFixed(2)}`;\r\n    const rev = Number(r.revenue || 0);\r\n    return `$${((rev / imps) * 1000).toFixed(2)}`;\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-inner\">\r\n      <div className=\"page-header\">\r\n        <div>\r\n          <h1 className=\"page-title\">Analytics</h1>\r\n          <p className=\"page-subtitle\">Providers performance for selected period</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"split-layout\">\r\n        <aside className=\"side-panel\">\r\n          <div className=\"panel-title\">Overview</div>\r\n\r\n          <div className=\"stats-list\">\r\n            <div className=\"stat-row\">\r\n              <span>Period</span>\r\n              <strong>{period}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>Providers</span>\r\n              <strong>{rows.length}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>Impressions</span>\r\n              <strong>{totals.totalImpressions}</strong>\r\n            </div>\r\n\r\n            <div className=\"stat-row\">\r\n              <span>Revenue</span>\r\n              <strong>${totals.totalRevenue.toFixed(2)}</strong>\r\n            </div>\r\n\r\n            {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n            <div className=\"stat-row\">\r\n              <span>Cost</span>\r\n              <strong>${totals.totalCost.toFixed(2)}</strong>\r\n            </div>\r\n\r\n            {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n            <div className=\"stat-row\">\r\n              <span>Profit</span>\r\n              <strong>${totals.totalProfit.toFixed(2)}</strong>\r\n            </div>\r\n\r\n            {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n            <div className=\"stat-row\">\r\n              <span>CPM</span>\r\n              <strong>{totals.totalImpressions < 10 ? \"‚Äî\" : `$${totals.cpm.toFixed(2)}`}</strong>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"panel-divider\" />\r\n\r\n          <div className=\"panel-title\">Period</div>\r\n          <div className=\"analytics-filters\">\r\n            {([\"today\", \"7d\", \"30d\"] as const).map((p) => (\r\n              <button\r\n                key={p}\r\n                className={`filter ${period === p ? \"active\" : \"\"}`}\r\n                onClick={() => setPeriod(p)}\r\n              >\r\n                {p}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </aside>\r\n\r\n        <section className=\"main-panel\">\r\n          <div className=\"chart-card\">\r\n            <div className=\"chart-head\">\r\n              <div className=\"chart-title\">Revenue / Impressions</div>\r\n              <div className=\"chart-sub\">({period})</div>\r\n            </div>\r\n\r\n            <div className=\"chart-box\">\r\n              {loading ? (\r\n                <div className=\"loading\">Loading‚Ä¶</div>\r\n              ) : !mounted ? null : chartData.length === 0 ? (\r\n                <div className=\"empty\">No data for this period</div>\r\n              ) : (\r\n                <ResponsiveContainer width=\"100%\" height={260}>\r\n                  <BarChart\r\n                    data={chartData}\r\n                    margin={{ top: 16, right: 24, left: 0, bottom: 0 }}\r\n                  >\r\n                    <CartesianGrid\r\n                      stroke=\"rgba(255,255,255,0.08)\"\r\n                      strokeDasharray=\"3 3\"\r\n                    />\r\n                    <XAxis dataKey=\"provider\" stroke=\"#94a3b8\" fontSize={12} />\r\n                    <YAxis stroke=\"#94a3b8\" fontSize={12} />\r\n                    <Tooltip\r\n                      contentStyle={{\r\n                        background: \"#020617\",\r\n                        border: \"1px solid rgba(255,255,255,0.1)\",\r\n                        borderRadius: 8,\r\n                      }}\r\n                    />\r\n                    <Legend />\r\n                    <Bar dataKey=\"impressions\" fill=\"#38bdf8\" radius={[6, 6, 0, 0]} />\r\n                    <Bar dataKey=\"revenue\" fill=\"#a855f7\" radius={[6, 6, 0, 0]} />\r\n                  </BarChart>\r\n                </ResponsiveContainer>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"table-card\">\r\n            <table className=\"table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Provider</th>\r\n                  <th>Impressions</th>\r\n                  <th>Revenue ($)</th>\r\n\r\n                  {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n                  <th>Cost ($)</th>\r\n                  {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n                  <th>Profit ($)</th>\r\n\r\n                  <th>CPM ($)</th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody>\r\n                {rows.map((r) => (\r\n                  <tr key={r.provider}>\r\n                    <td className=\"capitalize\">{r.provider}</td>\r\n                    <td>{Number(r.impressions || 0)}</td>\r\n                    <td>${Number(r.revenue || 0).toFixed(2)}</td>\r\n\r\n                    {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n                    <td>${Number(r.cost || 0).toFixed(2)}</td>\r\n                    {/* ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û */}\r\n                    <td>${Number(r.profit || (Number(r.revenue || 0) - Number(r.cost || 0))).toFixed(2)}</td>\r\n\r\n                    <td>{showCPM(r)}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n\r\n            {loading && <div className=\"loading\">Loading‚Ä¶</div>}\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}